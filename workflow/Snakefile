import os
from snakemake.utils import min_version
min_version("6.12")

configfile: f"{workflow.basedir}/../config/config.yaml"

include: "rules/common.smk"
include: "rules/preproc.smk"
include: "rules/dim_reduce.smk"
include: "rules/cluster.smk"
include: "rules/plot.smk"


wildcard_constraints:
    # A can be anything that doesn't contain a 
    # '\', '.',  '/', or a whitespace
    qc_method = get_wc_constraint('qc_method'),
    dr_method = get_wc_constraint('dim_reduce_method'),
    c_method = get_wc_constraint('cluster_method')


onstart:
    if not os.path.exists(config['output_dir']):
        os.mkdir(config['output_dir'])


rule all:
    input:
        # This function is located in workflow/rules/common.smk
        get_final_output()
